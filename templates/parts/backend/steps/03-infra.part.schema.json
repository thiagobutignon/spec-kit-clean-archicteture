{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Backend Infrastructure Steps Configuration",
  "description": "Schema for backend infrastructure layer implementation steps with TDD methodology, focusing on Prisma, Redis, Fetch API, and Clean Architecture patterns",
  "type": "object",
  "required": ["infra_steps"],
  "properties": {
    "infra_steps": {
      "type": "array",
      "description": "Array of backend infrastructure layer implementation steps following TDD (Red-Green-Refactor) with database, HTTP, cache, and crypto implementations",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/infraStep"
      }
    }
  },
  "definitions": {
    "infraStep": {
      "type": "object",
      "required": ["id", "type", "description"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the backend infrastructure step with template placeholders",
          "pattern": "^[a-z0-9-_]+(__[A-Z_]+__[a-z0-9-_]*)*$"
        },
        "type": {
          "type": "string",
          "enum": ["folder", "create_file", "validation", "conditional_file"],
          "description": "Type of step: folder creation, file creation, validation, or conditional file"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of what this backend infrastructure step does"
        },
        "status": {
          "type": "string",
          "enum": ["PENDING", "SUCCESS", "FAILED", "SKIPPED"],
          "description": "Current status of the step execution"
        },
        "rlhf_score": {
          "type": ["integer", "null"],
          "minimum": -2,
          "maximum": 2,
          "description": "Reinforcement Learning from Human Feedback score"
        },
        "execution_log": {
          "type": "string",
          "description": "Log of step execution for backend infrastructure layer"
        },
        "references": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/reference"
          },
          "description": "References to patterns, guidelines, or documentation for backend infrastructure layer"
        },
        "action": {
          "$ref": "#/definitions/folderAction",
          "description": "Action for folder creation steps in backend infrastructure layer"
        },
        "path": {
          "type": "string",
          "description": "File path for create_file steps with template placeholders for backend infrastructure layer"
        },
        "template": {
          "type": "string",
          "description": "File content template for create_file steps with TypeScript/Node.js infrastructure code"
        },
        "validation_script": {
          "type": "string",
          "description": "Shell script for validation steps specific to backend infrastructure layer"
        },
        "run_scripts": {
          "type": "object",
          "required": ["description", "scripts"],
          "properties": {
            "description": {
              "type": "string",
              "description": "Description of what the backend infrastructure validation scripts do"
            },
            "scripts": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/script"
              },
              "minItems": 1,
              "description": "List of scripts to run for backend infrastructure validation (npm, jest, prisma, etc.)"
            }
          },
          "description": "Scripts to run for backend infrastructure validation steps"
        },
        "condition": {
          "type": "string",
          "description": "Condition function name for conditional_file steps in backend infrastructure layer"
        }
      }
    },
    "folderAction": {
      "type": "object",
      "required": ["create_folders"],
      "properties": {
        "create_folders": {
          "type": "object",
          "required": ["basePath", "folders"],
          "properties": {
            "basePath": {
              "type": "string",
              "description": "Base path where backend infrastructure layer folders will be created with template placeholders"
            },
            "folders": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "minItems": 1,
              "description": "List of backend infrastructure layer folder names to create (db, http, cache, crypto, validators, messaging, storage)"
            }
          }
        }
      }
    },
    "fileAction": {
      "type": "object",
      "required": ["create_file"],
      "properties": {
        "create_file": {
          "type": "object",
          "required": ["path", "content"],
          "properties": {
            "path": {
              "type": "string",
              "description": "File path for backend infrastructure layer with template placeholders"
            },
            "content": {
              "type": "string",
              "description": "File content with template placeholders and TypeScript/Node.js code for backend infrastructure layer"
            }
          }
        }
      }
    },
    "validationAction": {
      "type": "object",
      "required": ["run_scripts"],
      "properties": {
        "run_scripts": {
          "type": "object",
          "required": ["description", "scripts"],
          "properties": {
            "description": {
              "type": "string",
              "description": "Description of what the backend infrastructure validation scripts do"
            },
            "scripts": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/script"
              },
              "minItems": 1,
              "description": "List of scripts to run for backend infrastructure validation"
            }
          }
        }
      }
    },
    "script": {
      "type": "object",
      "required": ["name", "command"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable name for the backend infrastructure script"
        },
        "command": {
          "type": "string",
          "description": "Shell command to execute for backend infrastructure layer (npm, npx, jest, prisma, docker, etc.)"
        },
        "workingDirectory": {
          "type": "string",
          "description": "Working directory for the backend infrastructure command (optional)"
        }
      }
    },
    "reference": {
      "type": "object",
      "required": ["type", "source", "description"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["internal_guideline", "external_pattern", "internal_code_analysis"],
          "description": "Type of reference for backend infrastructure layer"
        },
        "source": {
          "type": "string",
          "description": "Source of the reference (e.g., context7, serena, BACKEND_ARCHITECTURE.md)"
        },
        "query": {
          "type": "string",
          "description": "Search query or pattern for external references related to backend infrastructure layer"
        },
        "url": {
          "type": "string",
          "description": "URL reference for external patterns related to backend infrastructure layer"
        },
        "tool": {
          "type": "string",
          "description": "Tool name for internal code analysis of backend infrastructure layer"
        },
        "description": {
          "type": "string",
          "description": "Description of what this reference provides for backend infrastructure layer"
        }
      }
    }
  }
}