---
title: "Validate Domain JSON Plan"
description: "Automated quality assurance validation for selected layer JSON plans with RLHF scoring impact assessment"
category: "layer"
stage: "validation"
priority: 2
tags:
  - validation
  - quality-assurance
  - rlhf-scoring
  - domain-purity
  - clean-architecture
parameters:
  input:
    type: "json"
    description: "JSON plan generated by /01-plan-domain-features command"
    required: true
  output_success:
    type: "json"
    format: '{"status": "SUCCESS", "message": "string", "qualityScore": "PERFECT|GOOD|ACCEPTABLE"}'
  output_failure:
    type: "json"
    format: '{"status": "FAILED", "errors": ["string"], "severity": "CATASTROPHIC|RUNTIME|WARNING"}'
scoring_impact:
  catastrophic:
    score: -2
    causes: ["Wrong REPLACE/WITH format", "Architecture violations", "External dependencies"]
  runtime_error:
    score: -1
    causes: ["Missing placeholders", "Invalid templates", "Path inconsistencies"]
  low_confidence:
    score: 0
    causes: ["Missing references", "Unclear concepts", "Empty arrays"]
  good:
    score: 1
    causes: ["Valid but missing ubiquitous language", "No @layerConcept tags"]
  perfect:
    score: 2
    requirements: ["Complete ubiquitous language", "DDD concepts", "@layerConcept tags", "Clean architecture"]
validation_categories:
  - "Schema and Structure"
  - "Logical Consistency"
  - "Content and Naming"
  - "Selected Layer Purity"
  - "RLHF Quality Indicators"
previous_command: "/01-plan-domain-features"
next_command: "/03-generate-layer-code create feature from json: <validated-json>"
---

# Task: Validate Domain JSON Plan

## ü§ñ RLHF Scoring Impact

This validation directly affects your RLHF score:

| Score | Level | Impact | Common Causes |
|-------|-------|--------|---------------|
| **-2** | CATASTROPHIC | Build failure | Wrong REPLACE/WITH format, architecture violations |
| **-1** | RUNTIME ERROR | Execution failure | Missing placeholders, invalid templates |
| **0** | LOW CONFIDENCE | System uncertainty | Missing references, unclear concepts |
| **+1** | GOOD | Working solution | Valid but missing ubiquitous language |
| **+2** | PERFECT | Excellence | Complete DDD concepts and ubiquitous language |

## 1. Your Deliverable

Your **only** output for this task is a validation report in JSON format.

### ‚úÖ Success Output:
```json
{
  "status": "SUCCESS",
  "message": "JSON plan is valid and complete.",
  "qualityScore": "PERFECT|GOOD|ACCEPTABLE"
}
```

### ‚ùå Failure Output:
```json
{
  "status": "FAILED",
  "errors": ["error message with RLHF impact"],
  "severity": "CATASTROPHIC|RUNTIME|WARNING"
}
```

## 2. Objective

Act as an **automated quality assurance engineer**. Validate the JSON plan against a strict set of logical and structural rules to ensure it will generate a valid selected layer following Clean Architecture principles.

## 3. Input Parameters

- **JSON Plan:** The JSON object generated by the `/01-plan-domain-features` command

## 4. Validation Checklist (Rules of Engagement)

You **MUST** validate the input JSON against every rule in this checklist. The validation fails if even one rule is violated.

### A. Schema and Structure Validation üìã

| Rule | Description | Impact if Violated |
|------|-------------|-------------------|
| **Root Keys** | Must contain `featureName` (string) and `steps` (array) | RUNTIME (-1) |
| **Ubiquitous Language** | If present, must be object with string key-value pairs | GOOD (+1) if missing |
| **Step Keys** | Every step must have `id`, `type`, `description`, `path` | RUNTIME (-1) |
| **Step Types** | Must be one of: `create_file`, `refactor_file`, `delete_file`, `folder` | RUNTIME (-1) |
| **References** | Every step must have `references` array (can be empty for errors) | LOW CONFIDENCE (0) |

### B. Logical Consistency and Completeness üîç

#### Path Consistency
- [ ] The `path` in each step must be consistent with the `featureName`
- [ ] Example: `featureName: "UserAccount"` ‚Üí path should contain `features/user-account/`

#### Template Completeness for `create_file`:

| File Type | Required Placeholders | Required Fields | RLHF Impact |
|-----------|----------------------|-----------------|-------------|
| **Use Case** | `__USE_CASE_INPUT_FIELDS__`<br>`__USE_CASE_OUTPUT_FIELDS__` | `input[]`, `output[]` | -1 if missing |
| **Test Helper** | `__MOCK_INPUT_DATA__`<br>`__MOCK_OUTPUT_DATA__` | `mockInput{}`, `mockOutput{}` | -1 if missing |
| **Error Class** | None (complete template) | None | N/A |

> üèÜ **For +2 Score:** Templates should include JSDoc comments with `@layerConcept` and `@pattern` tags

#### Template Correctness for `refactor_file`:
- [ ] Must contain exactly one `<<<REPLACE>>>...<<</REPLACE>>>` block
- [ ] Must contain exactly one `<<<WITH>>>...<<</WITH>>>` block
- [ ] **‚ö†Ô∏è CRITICAL:** Invalid format causes CATASTROPHIC (-2) error

#### Dependency Sanity:
- [ ] No `refactor_file` or `delete_file` before corresponding `create_file`
- [ ] Steps should generally start with `folder` or `create_file`

### C. Content and Naming Conventions üìù

| Convention | Rule | Example | Impact |
|------------|------|---------|--------|
| **Type Names** | PascalCase | `CreateUser` ‚úÖ<br>`create-user` ‚ùå | -1 |
| **IDs & Paths** | kebab-case | `create-user-use-case` ‚úÖ<br>`CreateUserUseCase` ‚ùå | -1 |
| **Use Cases** | Must be verbs | `CreateUser` ‚úÖ<br>`UserCreator` ‚ùå | -1 |
| **Mock Data** | Must exist for use cases | Non-empty `mockInput` & `mockOutput` | 0 |

### D. Selected Layer Purity Validation üõ°Ô∏è (RLHF Critical)

#### ‚ùå **FORBIDDEN - Causes CATASTROPHIC (-2)**:
```typescript
// These imports will fail validation:
import axios from 'axios';              // ‚ùå External library
import { PrismaClient } from '@prisma/client'; // ‚ùå Database
import express from 'express';          // ‚ùå Framework
import React from 'react';              // ‚ùå UI library
```

#### ‚úÖ **REQUIRED Patterns**:

| Pattern | Requirement | Example | Score Impact |
|---------|-------------|---------|--------------|
| **Use Cases** | Must be interfaces with `execute` method | `interface CreateUser { execute(...) }` | -2 if class |
| **Errors** | Must extend native `Error` | `class UserError extends Error` | -1 if custom |
| **Types** | Only TypeScript native types | `string`, `number`, `Date` | -2 if external |
| **Logic** | NO implementation in domain | Types only, no logic | -2 if present |

### E. RLHF Quality Indicators üèÜ

Quality scoring criteria for achieving higher RLHF scores:

| Indicator | Requirement | Impact | Score |
|-----------|------------|--------|-------|
| **Ubiquitous Language** | Present with meaningful business terms | Missing prevents +2 | +2 |
| **Domain Documentation** | `@layerConcept` tags in templates | Quality indicator | +1 to +2 |
| **Reference Quality** | Meaningful references to patterns | Empty = low confidence | 0 to +1 |
| **Test Coverage** | Test helper for every use case | Missing = incomplete | +1 |
| **DDD Alignment** | Proper Value Objects, Entities, Aggregates | Excellence indicator | +2 |

## 5. Step-by-Step Execution Plan

```mermaid
graph TD
    A[Parse Input JSON] --> B[Validate Schema]
    B --> C[Check Logical Consistency]
    C --> D[Verify Layer Purity]
    D --> E[Assess RLHF Quality]
    E --> F{Any Violations?}
    F -->|No| G[Generate SUCCESS Report]
    F -->|Yes| H[Generate FAILED Report]
    G --> I[Include Quality Score]
    H --> J[Include Error Details & Severity]
```

### Execution Steps:

1. **Parse Input:** Receive and parse the JSON plan
2. **Iterate Checklist:** Validate against all rules systematically
3. **Calculate RLHF Impact:** Assess severity based on violations
4. **Collect Errors:** Build detailed error list with impact scores
5. **Generate Report:** Produce appropriate JSON output

## 6. Example Validations

### Example 1: ‚úÖ Valid JSON (PERFECT Score)

<details>
<summary>Input JSON</summary>

```json
{
  "featureName": "UserAccount",
  "ubiquitousLanguage": {
    "Account": "User's identity in the system",
    "Registration": "Process of creating new account"
  },
  "steps": [
    {
      "id": "create-use-case-create-user-account",
      "type": "create_file",
      "description": "Create user account use case",
      "path": "src/features/user-account/[LAYER]/use-cases/create-user-account.ts",
      "references": [
        {
          "type": "external_pattern",
          "source": "context7",
          "description": "DDD patterns for user registration"
        }
      ],
      "template": "/**\n * @layerConcept User Account Creation\n */\nexport interface CreateUserAccount {\n  execute(input: CreateUserAccountInput): Promise<CreateUserAccountOutput>;\n}\n\nexport type CreateUserAccountInput = {\n  __USE_CASE_INPUT_FIELDS__\n};\n\nexport type CreateUserAccountOutput = {\n  __USE_CASE_OUTPUT_FIELDS__\n};",
      "input": [
        { "name": "email", "type": "string" },
        { "name": "password", "type": "string" }
      ],
      "output": [
        { "name": "id", "type": "string" },
        { "name": "email", "type": "string" }
      ]
    }
  ]
}
```
</details>

**Output:**
```json
{
  "status": "SUCCESS",
  "message": "JSON plan is valid and complete.",
  "qualityScore": "PERFECT"
}
```

### Example 2: ‚ùå Invalid JSON (RUNTIME Error)

<details>
<summary>Input JSON with Errors</summary>

```json
{
  "featureName": "UserAccount",
  "steps": [
    {
      "id": "create-use-case-create-user-account",
      "type": "create_file",
      "description": "Create user account",
      "path": "src/features/some-other-feature/use-cases/create.ts",
      "references": [],
      "template": "import axios from 'axios';\n\nclass CreateUserAccount {\n  // Implementation here\n}"
    }
  ]
}
```
</details>

**Output:**
```json
{
  "status": "FAILED",
  "errors": [
    "Path inconsistency: 'src/features/some-other-feature' doesn't match featureName 'UserAccount' (RLHF: -1)",
    "Empty references array: Missing pattern documentation (RLHF: 0)",
    "External dependency detected: 'axios' import forbidden in domain (RLHF: -2)",
    "Use case as class: Must be interface, not class (RLHF: -2)",
    "Missing placeholders: No __USE_CASE_INPUT_FIELDS__ found (RLHF: -1)",
    "Missing field definitions: 'input' and 'output' arrays required (RLHF: -1)"
  ],
  "severity": "CATASTROPHIC"
}
```

## 7. Severity Classification

| Severity | RLHF Score | When Applied | Recovery Action |
|----------|------------|--------------|-----------------|
| **CATASTROPHIC** | -2 | Architecture violations, external dependencies | Complete redesign required |
| **RUNTIME** | -1 | Missing required fields, invalid syntax | Fix specific issues |
| **WARNING** | 0 | Missing quality indicators | Enhance for better score |

## üìç Next Steps

Based on your validation results:

### ‚úÖ If validation PASSED (SUCCESS):
Proceed to generate the YAML plan:
```bash
/03-generate-layer-code create feature from json: <your-validated-json>
```

### ‚ùå If validation FAILED:
Fix the identified issues and re-run validation:
```bash
/02-validate-layer-plan from json: <your-corrected-json>
```

> üí° **Pro Tip**: Address CATASTROPHIC errors first, then RUNTIME errors, and finally optimize for PERFECT score by adding quality indicators.